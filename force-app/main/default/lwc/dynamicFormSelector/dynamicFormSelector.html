<template>
  <!-- Unified Container with White Background -->
  <div class="unified-container">
    <!-- Dynamic Form Selector Section -->
    <div class="slds-var-p-vertical_medium">
      <div class="slds-var-m-bottom_medium slds-var-p-left_small slds-grid slds-grid_vertical-align-center slds-grid_align-spread" style="gap: 0.5rem;">
        <div class="slds-grid slds-grid_vertical-align-center" style="gap: 0.5rem;">
          <lightning-icon icon-name="action:new_notebook" size="xx-small" class="purple-icon"></lightning-icon>
          <h2 class="slds-text-heading_medium slds-text-color_default">RocketForm</h2>
        </div>
        <template if:true={hasDashboardForms}>
          <div class="slds-grid slds-grid_vertical-align-center slds-var-m-right_x-small">
            <button 
              class={dashboardToggleButtonClass}
              onclick={handleDashboardToggle}
              title={dashboardToggleTitle}>
              <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 28L6 12H34L20 28Z" fill="#0176d3" stroke="#0176d3" stroke-width="1" stroke-linejoin="round" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
        </template>
      </div>
      
      <!-- Form Dashboard Section (above Create) -->
      <template if:true={hasDashboardForms}>
        <template if:true={isDashboardVisible}>
          <div class="slds-var-p-horizontal_medium slds-var-m-bottom_medium dashboard-forms-container">
            <template for:each={formList} for:item="form">
              <div key={form.id} class="slds-card form-card slds-var-m-bottom_small">
                <div class="slds-var-p-around_medium dashboard-card-content">
                  <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center slds-var-m-bottom_small dashboard-main-grid">
                    <div class="slds-col slds-text-align_left left-section">
                      <span class="slds-badge form-badge form-badge-full-width">{form.label}</span>
                    </div>
                    <div class="slds-col slds-shrink-none slds-text-align_right">
                      <div class="slds-grid slds-grid_vertical-align-center right-actions" style="gap: 1rem;">
                        <span class={form.progressTextClass}>{form.progressText}</span>
                        <lightning-button label="Edit" 
                                        variant="neutral" 
                                        class="pill-button edit-button-no-margin"
                                        data-session-key={form.sessionKey}
                                        onclick={handleEditForm}>
                        </lightning-button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </template>
      </template>
      
      <template if:true={isLoading}>
        <div class="slds-grid slds-grid_align-center slds-var-p-around_x-large">
          <lightning-spinner alternative-text="Loading forms" size="small"></lightning-spinner>
        </div>
      </template>

      <template if:false={isLoading}>
        <template if:true={hasForms}>
          <div class="slds-grid slds-wrap slds-var-p-horizontal_medium" style="gap: 0.75rem;">
            <template for:each={forms} for:item="form">
              <lightning-button key={form.id}
                              label={form.label}
                              class="pill-button"
                              data-id={form.id}
                              onclick={handleNavigate}
                              onkeydown={handleTileKeydown}
                              variant="neutral">
              </lightning-button>
            </template>
          </div>
        </template>
        
        <template if:false={hasForms}>
          <div class="slds-text-align_center slds-var-p-around_x-large">
            <p class="slds-text-body_small slds-text-color_weak">No forms available</p>
          </div>
        </template>
      </template>
    </div>
  </div>
</template>
