<template>
    <lightning-card title="RocketForm Builder" icon-name="standard:process">
        <!-- Loading Spinner -->
        <template if:true={isLoading}>
            <div class="slds-var-p-around_large slds-text-align_center">
                <lightning-spinner alternative-text="Loading analysis data..." size="large"></lightning-spinner>
                <p class="slds-var-m-top_small">Loading analysis data...</p>
            </div>
        </template>
        
        <!-- Main Content -->
        <template if:false={isLoading}>
            <!-- Progress Indicator -->
            <div class="slds-var-p-horizontal_large slds-var-p-top_large slds-var-p-bottom_medium">
                <div class="slds-var-m-bottom_large">
                    <lightning-progress-indicator current-step={currentStepNumber} type="path" variant="base">
                        <lightning-progress-step label="Object Selection" value="1"></lightning-progress-step>
                        <lightning-progress-step label="Create Sections" value="2"></lightning-progress-step>
                        <lightning-progress-step label="Review & Save" value="3"></lightning-progress-step>
                    </lightning-progress-indicator>
                </div>
                
                <!-- Step Content -->
                <div class="slds-var-p-horizontal_medium">
                <!-- Step 1: Object Selection -->
                <template if:true={isStep1}>
                    <c-object-selector 
                        initial-selected-object={analysisData.selectedObject}
                        initial-selected-record-type={analysisData.selectedRecordType}
                        initial-selected-record-type-name={analysisData.selectedRecordTypeName}
                        initial-form-name={analysisData.formName}
                        onobjectselected={handleObjectSelected}
                        onerror={handleError}>
                    </c-object-selector>
                </template>
                
                <!-- Step 2: Create Sections -->
                <template if:true={isStep2}>
                    <c-section-builder
                        selected-object={analysisData.selectedObject}
                        selected-record-type={analysisData.selectedRecordType}
                        selected-record-type-name={analysisData.selectedRecordTypeName}
                        initial-sections={analysisData.sections}
                        onsectionscreated={handleSectionsCreated}
                        onsectionssync={handleSectionsSync}
                        ongoback={handleGoBack}
                        onerror={handleError}>
                    </c-section-builder>
                </template>
                
                <!-- Step 3: Review & Save -->
                <template if:true={isStep3}>
                    <c-analysis-review 
                        analysis-data={analysisData}
                        analysis-id={analysisId}
                        is-edit-mode={isEditMode}
                        onanalysissaved={handleAnalysisSaved}
                        ongoback={handleGoBack}
                        onstartover={handleStartOver}
                        onerror={handleError}>
                    </c-analysis-review>
                </template>
                </div>
            </div>
        </template>
    </lightning-card>
</template>